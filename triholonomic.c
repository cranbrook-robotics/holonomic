#pragma config(Motor,  motor3,          right,         tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor4,          left,          tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor10,         front,         tmotorVexIQ, PIDControl, reversed, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//


#define min(a,b) (((a)<(b))?(a):(b))
#define max(a,b) (((a)>(b))?(a):(b))

#define getJoyDriveY() getJoystickValue(ChA)
#define getJoyDriveX() getJoystickValue(ChB)
#define getJoyDriveR() getJoystickValue(ChC)


task main()
{
	const float LeftWheelHeading = degreesToRadians(300);
	const float RightWheelHeading = degreesToRadians(60);
	const float FrontWheelHeading = degreesToRadians(180);

	const float MotorMax = 100.0;
	const float ControllerMax = 127.0;


	while(1){
		int driveY = getJoyDriveY();
		int driveX = getJoyDriveX();
		float driveHeading = atan2(driveY, driveX);
		float driveMagnitude = sqrt( driveX*driveX + driveY*driveY ) / ControllerMax;
		float driveRotation = -getJoyDriveR() / ControllerMax;

		float leftAngle = abs( driveHeading - LeftWheelHeading );
		float rightAngle = abs( driveHeading - RightWheelHeading );
		float frontAngle = abs( driveHeading - FrontWheelHeading );

		float leftSpeed = driveMagnitude * cos(leftAngle) + driveRotation;
		float rightSpeed = driveMagnitude * cos(rightAngle) + driveRotation;
		float frontSpeed = driveMagnitude * cos(frontAngle) + driveRotation;

		float maxSpeed = max(max(leftSpeed, rightSpeed), frontSpeed);
		float speedFactor = MotorMax;
		if( maxSpeed > 1.0 ){
			speedFactor /= maxSpeed;
		}

		setMotorSpeed( left, speedFactor * leftSpeed );
		setMotorSpeed( right, speedFactor * rightSpeed );
		setMotorSpeed( front, speedFactor * frontSpeed );
	}
}
